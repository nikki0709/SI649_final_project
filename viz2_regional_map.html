<html>
<head><meta charset="utf-8" /></head>
<body>
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.1.1.min.js" integrity="sha256-HUEFyfiTnZJxCxur99FjbKYTvKSzwDaD3/x5TqHpFu4=" crossorigin="anonymous"></script>                <div class="plotly-container"><div id="b8b8f716-ff41-4b9c-a207-e6a028760797" class="plotly-graph-div" style="height:550px; width:700px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("b8b8f716-ff41-4b9c-a207-e6a028760797")) {                    Plotly.newPlot(                        "b8b8f716-ff41-4b9c-a207-e6a028760797",                        [{"colorbar":{"len":0.5,"thickness":15,"tickfont":{"size":11},"title":{"font":{"size":12,"weight":"bold"},"text":"Devotion\u003cbr\u003eScore"},"x":1.02,"xpad":5},"colorscale":[[0.0,"rgb(255,255,204)"],[0.125,"rgb(255,237,160)"],[0.25,"rgb(254,217,118)"],[0.375,"rgb(254,178,76)"],[0.5,"rgb(253,141,60)"],[0.625,"rgb(252,78,42)"],[0.75,"rgb(227,26,28)"],[0.875,"rgb(189,0,38)"],[1.0,"rgb(128,0,38)"]],"hovertemplate":"%{text}\u003cextra\u003e\u003c\u002fextra\u003e","locationmode":"USA-states","locations":["CO","VA","GA","AK","NV","TX","AR","WA","DE","OR","AL","RI","CA","MA","NY","MD","IL","WI","NJ","NM","WV","MN","NH","UT","LA","ND","MS","AZ","VT","CT","NC","OH","ID","IN","SD","KY","TN","KS","WY","FL","SC","OK","HI","IA","NE","MI","MO","ME","MT","PA"],"marker":{"line":{"color":"white","width":1}},"text":["Colorado\u003cbr\u003eDevotion Score: 100.00\u003cbr\u003eRank: #1\u003cbr\u003eMoved for dog: 19.5%\u003cbr\u003eBroke up over dog: 8.5%","Virginia\u003cbr\u003eDevotion Score: 94.41\u003cbr\u003eRank: #2\u003cbr\u003eMoved for dog: 16.5%\u003cbr\u003eBroke up over dog: 9.5%","Georgia\u003cbr\u003eDevotion Score: 92.45\u003cbr\u003eRank: #3\u003cbr\u003eMoved for dog: 18.0%\u003cbr\u003eBroke up over dog: 9.5%","Alaska\u003cbr\u003eDevotion Score: 91.99\u003cbr\u003eRank: #4\u003cbr\u003eMoved for dog: 16.0%\u003cbr\u003eBroke up over dog: 13.5%","Nevada\u003cbr\u003eDevotion Score: 87.92\u003cbr\u003eRank: #5\u003cbr\u003eMoved for dog: 20.0%\u003cbr\u003eBroke up over dog: 9.5%","Texas\u003cbr\u003eDevotion Score: 81.42\u003cbr\u003eRank: #6\u003cbr\u003eMoved for dog: 16.5%\u003cbr\u003eBroke up over dog: 10.0%","Arkansas\u003cbr\u003eDevotion Score: 80.97\u003cbr\u003eRank: #7\u003cbr\u003eMoved for dog: 15.0%\u003cbr\u003eBroke up over dog: 8.0%","Washington\u003cbr\u003eDevotion Score: 80.97\u003cbr\u003eRank: #7\u003cbr\u003eMoved for dog: 17.5%\u003cbr\u003eBroke up over dog: 7.0%","Delaware\u003cbr\u003eDevotion Score: 71.15\u003cbr\u003eRank: #9\u003cbr\u003eMoved for dog: 16.5%\u003cbr\u003eBroke up over dog: 7.5%","Oregon\u003cbr\u003eDevotion Score: 70.69\u003cbr\u003eRank: #10\u003cbr\u003eMoved for dog: 12.5%\u003cbr\u003eBroke up over dog: 8.0%","Alabama\u003cbr\u003eDevotion Score: 70.24\u003cbr\u003eRank: #11\u003cbr\u003eMoved for dog: 16.0%\u003cbr\u003eBroke up over dog: 10.5%","Rhode Island\u003cbr\u003eDevotion Score: 68.43\u003cbr\u003eRank: #12\u003cbr\u003eMoved for dog: 13.0%\u003cbr\u003eBroke up over dog: 8.0%","California\u003cbr\u003eDevotion Score: 66.31\u003cbr\u003eRank: #13\u003cbr\u003eMoved for dog: 15.0%\u003cbr\u003eBroke up over dog: 10.0%","Massachusetts\u003cbr\u003eDevotion Score: 65.41\u003cbr\u003eRank: #14\u003cbr\u003eMoved for dog: 15.5%\u003cbr\u003eBroke up over dog: 9.0%","New York\u003cbr\u003eDevotion Score: 62.39\u003cbr\u003eRank: #15\u003cbr\u003eMoved for dog: 8.5%\u003cbr\u003eBroke up over dog: 8.0%","Maryland\u003cbr\u003eDevotion Score: 61.18\u003cbr\u003eRank: #16\u003cbr\u003eMoved for dog: 16.0%\u003cbr\u003eBroke up over dog: 7.0%","Illinois\u003cbr\u003eDevotion Score: 59.82\u003cbr\u003eRank: #17\u003cbr\u003eMoved for dog: 17.0%\u003cbr\u003eBroke up over dog: 7.0%","Wisconsin\u003cbr\u003eDevotion Score: 59.82\u003cbr\u003eRank: #17\u003cbr\u003eMoved for dog: 14.5%\u003cbr\u003eBroke up over dog: 10.5%","New Jersey\u003cbr\u003eDevotion Score: 59.21\u003cbr\u003eRank: #19\u003cbr\u003eMoved for dog: 16.0%\u003cbr\u003eBroke up over dog: 5.5%","New Mexico\u003cbr\u003eDevotion Score: 54.83\u003cbr\u003eRank: #20\u003cbr\u003eMoved for dog: 17.0%\u003cbr\u003eBroke up over dog: 7.5%","West Virginia\u003cbr\u003eDevotion Score: 53.47\u003cbr\u003eRank: #21\u003cbr\u003eMoved for dog: 15.0%\u003cbr\u003eBroke up over dog: 5.5%","Minnesota\u003cbr\u003eDevotion Score: 51.21\u003cbr\u003eRank: #22\u003cbr\u003eMoved for dog: 15.0%\u003cbr\u003eBroke up over dog: 8.0%","New Hampshire\u003cbr\u003eDevotion Score: 48.19\u003cbr\u003eRank: #23\u003cbr\u003eMoved for dog: 12.5%\u003cbr\u003eBroke up over dog: 5.0%","Utah\u003cbr\u003eDevotion Score: 44.86\u003cbr\u003eRank: #24\u003cbr\u003eMoved for dog: 13.0%\u003cbr\u003eBroke up over dog: 5.5%","Louisiana\u003cbr\u003eDevotion Score: 43.50\u003cbr\u003eRank: #25\u003cbr\u003eMoved for dog: 11.5%\u003cbr\u003eBroke up over dog: 11.0%","North Dakota\u003cbr\u003eDevotion Score: 43.20\u003cbr\u003eRank: #26\u003cbr\u003eMoved for dog: 16.5%\u003cbr\u003eBroke up over dog: 6.0%","Mississippi\u003cbr\u003eDevotion Score: 42.45\u003cbr\u003eRank: #27\u003cbr\u003eMoved for dog: 14.5%\u003cbr\u003eBroke up over dog: 7.5%","Arizona\u003cbr\u003eDevotion Score: 40.03\u003cbr\u003eRank: #28\u003cbr\u003eMoved for dog: 14.5%\u003cbr\u003eBroke up over dog: 6.0%","Vermont\u003cbr\u003eDevotion Score: 38.07\u003cbr\u003eRank: #29\u003cbr\u003eMoved for dog: 12.5%\u003cbr\u003eBroke up over dog: 6.0%","Connecticut\u003cbr\u003eDevotion Score: 34.74\u003cbr\u003eRank: #30\u003cbr\u003eMoved for dog: 9.5%\u003cbr\u003eBroke up over dog: 6.5%","North Carolina\u003cbr\u003eDevotion Score: 32.78\u003cbr\u003eRank: #31\u003cbr\u003eMoved for dog: 12.5%\u003cbr\u003eBroke up over dog: 8.5%","Ohio\u003cbr\u003eDevotion Score: 32.48\u003cbr\u003eRank: #32\u003cbr\u003eMoved for dog: 12.0%\u003cbr\u003eBroke up over dog: 3.0%","Idaho\u003cbr\u003eDevotion Score: 32.33\u003cbr\u003eRank: #33\u003cbr\u003eMoved for dog: 14.0%\u003cbr\u003eBroke up over dog: 7.5%","Indiana\u003cbr\u003eDevotion Score: 32.02\u003cbr\u003eRank: #34\u003cbr\u003eMoved for dog: 11.5%\u003cbr\u003eBroke up over dog: 7.0%","South Dakota\u003cbr\u003eDevotion Score: 31.27\u003cbr\u003eRank: #35\u003cbr\u003eMoved for dog: 16.5%\u003cbr\u003eBroke up over dog: 5.0%","Kentucky\u003cbr\u003eDevotion Score: 29.46\u003cbr\u003eRank: #36\u003cbr\u003eMoved for dog: 12.0%\u003cbr\u003eBroke up over dog: 5.0%","Tennessee\u003cbr\u003eDevotion Score: 28.85\u003cbr\u003eRank: #37\u003cbr\u003eMoved for dog: 12.5%\u003cbr\u003eBroke up over dog: 5.5%","Kansas\u003cbr\u003eDevotion Score: 25.68\u003cbr\u003eRank: #38\u003cbr\u003eMoved for dog: 19.0%\u003cbr\u003eBroke up over dog: 5.0%","Wyoming\u003cbr\u003eDevotion Score: 25.53\u003cbr\u003eRank: #39\u003cbr\u003eMoved for dog: 8.0%\u003cbr\u003eBroke up over dog: 5.5%","Florida\u003cbr\u003eDevotion Score: 22.05\u003cbr\u003eRank: #40\u003cbr\u003eMoved for dog: 13.0%\u003cbr\u003eBroke up over dog: 5.0%","South Carolina\u003cbr\u003eDevotion Score: 19.49\u003cbr\u003eRank: #41\u003cbr\u003eMoved for dog: 14.5%\u003cbr\u003eBroke up over dog: 5.5%","Oklahoma\u003cbr\u003eDevotion Score: 16.92\u003cbr\u003eRank: #42\u003cbr\u003eMoved for dog: 17.0%\u003cbr\u003eBroke up over dog: 5.0%","Hawaii\u003cbr\u003eDevotion Score: 13.60\u003cbr\u003eRank: #43\u003cbr\u003eMoved for dog: 12.0%\u003cbr\u003eBroke up over dog: 3.5%","Iowa\u003cbr\u003eDevotion Score: 13.60\u003cbr\u003eRank: #43\u003cbr\u003eMoved for dog: 9.5%\u003cbr\u003eBroke up over dog: 3.0%","Nebraska\u003cbr\u003eDevotion Score: 10.12\u003cbr\u003eRank: #45\u003cbr\u003eMoved for dog: 11.0%\u003cbr\u003eBroke up over dog: 5.0%","Michigan\u003cbr\u003eDevotion Score: 9.06\u003cbr\u003eRank: #46\u003cbr\u003eMoved for dog: 6.5%\u003cbr\u003eBroke up over dog: 3.5%","Missouri\u003cbr\u003eDevotion Score: 8.91\u003cbr\u003eRank: #47\u003cbr\u003eMoved for dog: 10.5%\u003cbr\u003eBroke up over dog: 5.5%","Maine\u003cbr\u003eDevotion Score: 1.96\u003cbr\u003eRank: #48\u003cbr\u003eMoved for dog: 11.0%\u003cbr\u003eBroke up over dog: 3.0%","Montana\u003cbr\u003eDevotion Score: 1.06\u003cbr\u003eRank: #49\u003cbr\u003eMoved for dog: 15.0%\u003cbr\u003eBroke up over dog: 3.5%","Pennsylvania\u003cbr\u003eDevotion Score: 0.00\u003cbr\u003eRank: #50\u003cbr\u003eMoved for dog: 9.0%\u003cbr\u003eBroke up over dog: 3.5%"],"z":{"dtype":"f8","bdata":"AAAAAAAAWUAK16NwPZpXQM3MzMzMHFdAj8L1KFz\u002fVkB7FK5H4fpVQHsUrkfhWlRArkfhehQ+VECuR+F6FD5UQJqZmZmZyVFAXI\u002fC9SisUUCPwvUoXI9RQOxRuB6FG1FApHA9CteTUEAK16NwPVpQQFK4HoXrMU9A16NwPQqXTkApXI\u002fC9ehNQClcj8L16E1AexSuR+GaTUAK16NwPWpLQFyPwvUovEpAexSuR+GaSUC4HoXrURhIQK5H4XoUbkZAAAAAAADARUCamZmZmZlFQJqZmZmZOUVApHA9CtcDREApXI\u002fC9QhDQB+F61G4XkFApHA9CtdjQEA9CtejcD1AQArXo3A9KkBAw\u002fUoXI8CQECF61G4HkU\u002fQPYoXI\u002fCdT1AmpmZmZnZPECuR+F6FK45QEjhehSuhzlAzczMzMwMNkA9CtejcH0zQOxRuB6F6zBAMzMzMzMzK0AzMzMzMzMrQD0K16NwPSRAH4XrUbgeIkBSuB6F69EhQFyPwvUoXP8\u002f9ihcj8L18D8AAAAAAAAAAA=="},"type":"choropleth"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"font":{"size":16,"color":"#2c3e50","weight":"bold"},"text":"Dog Owner Devotion by State","x":0.5,"xanchor":"center"},"geo":{"scope":"usa","projection":{"type":"albers usa"},"showlakes":true,"lakecolor":"rgb(255, 255, 255)","bgcolor":"rgba(0,0,0,0)"},"margin":{"l":0,"r":0,"t":50,"b":0},"width":700,"height":550,"plot_bgcolor":"white","paper_bgcolor":"white"},                        {"modeBarButtonsToAdd": ["downloadImage"], "displayModeBar": true, "displaylogo": false, "modeBarButtonsToRemove": ["pan2d", "lasso2d", "select2d"], "toImageButtonOptions": {"format": "png", "filename": "dog_owner_devotion_map", "height": 600, "width": 900, "scale": 1}, "responsive": true}                    )                };            </script>        </div>

<style>
.comparison-panel {
    position: absolute;
    top: 60px;
    right: 20px;
    background: white;
    border: 2px solid #2c3e50;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 280px;
    max-width: 320px;
    z-index: 1000;
    font-family: Arial, sans-serif;
    font-size: 12px;
    display: none;
}

.comparison-panel.active {
    display: block;
}

.comparison-panel h3 {
    margin: 0 0 15px 0;
    color: #2c3e50;
    font-size: 14px;
    font-weight: bold;
    border-bottom: 2px solid #3498db;
    padding-bottom: 8px;
}

.comparison-instruction {
    color: #7f8c8d;
    font-size: 11px;
    font-style: italic;
    margin-bottom: 15px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 4px;
}

.state-comparison {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.state-box {
    border: 2px solid #ecf0f1;
    border-radius: 6px;
    padding: 10px;
    background: #f8f9fa;
}

.state-box.selected {
    border-color: #3498db;
    background: #ebf5fb;
}

.state-name {
    font-weight: bold;
    font-size: 13px;
    color: #2c3e50;
    margin-bottom: 8px;
    text-align: center;
}

.metric-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 11px;
}

.metric-label {
    color: #7f8c8d;
}

.metric-value {
    font-weight: bold;
    color: #2c3e50;
}

.comparison-diff {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #ecf0f1;
    font-size: 11px;
}

.diff-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
}

.diff-positive {
    color: #27ae60;
}

.diff-negative {
    color: #e74c3c;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 18px;
    color: #95a5a6;
    cursor: pointer;
    padding: 0;
    width: 20px;
    height: 20px;
    line-height: 20px;
}

.close-btn:hover {
    color: #2c3e50;
}

.plotly-container {
    position: relative;
}
</style>

<div class="comparison-panel" id="comparison-panel">
    <button class="close-btn" onclick="closeComparison()">Ã—</button>
    <h3>State Comparison</h3>
    <div class="comparison-instruction" id="comparison-instruction">
        Click two states on the map to compare them
    </div>
    <div class="state-comparison" id="state-comparison" style="display: none;">
        <div class="state-box" id="state1-box">
            <div class="state-name" id="state1-name">-</div>
            <div class="metric-row">
                <span class="metric-label">Devotion Score:</span>
                <span class="metric-value" id="state1-score">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Rank:</span>
                <span class="metric-value" id="state1-rank">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Moved for dog:</span>
                <span class="metric-value" id="state1-moved">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Broke up over dog:</span>
                <span class="metric-value" id="state1-breakup">-</span>
            </div>
        </div>
        <div class="state-box" id="state2-box">
            <div class="state-name" id="state2-name">-</div>
            <div class="metric-row">
                <span class="metric-label">Devotion Score:</span>
                <span class="metric-value" id="state2-score">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Rank:</span>
                <span class="metric-value" id="state2-rank">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Moved for dog:</span>
                <span class="metric-value" id="state2-moved">-</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Broke up over dog:</span>
                <span class="metric-value" id="state2-breakup">-</span>
            </div>
        </div>
        <div class="comparison-diff" id="comparison-diff" style="display: none;">
            <div class="diff-row">
                <span>Score Difference:</span>
                <span id="diff-score">-</span>
            </div>
            <div class="diff-row">
                <span>Moved % Difference:</span>
                <span id="diff-moved">-</span>
            </div>
            <div class="diff-row">
                <span>Breakup % Difference:</span>
                <span id="diff-breakup">-</span>
            </div>
        </div>
    </div>
</div>

<script>
var stateData = [{"State": "Colorado", "State Abbreviations": "CO", "Rank": 1, "Score": 100.0, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "19.50%", "Breakup_Percent": 8.5, "Moved_Percent": 19.5}, {"State": "Virginia", "State Abbreviations": "VA", "Rank": 2, "Score": 94.41, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "9.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.50%", "Breakup_Percent": 9.5, "Moved_Percent": 16.5}, {"State": "Georgia", "State Abbreviations": "GA", "Rank": 3, "Score": 92.45, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "9.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "18.00%", "Breakup_Percent": 9.5, "Moved_Percent": 18.0}, {"State": "Alaska", "State Abbreviations": "AK", "Rank": 4, "Score": 91.99, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "13.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.00%", "Breakup_Percent": 13.5, "Moved_Percent": 16.0}, {"State": "Nevada", "State Abbreviations": "NV", "Rank": 5, "Score": 87.92, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "9.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "20.00%", "Breakup_Percent": 9.5, "Moved_Percent": 20.0}, {"State": "Texas", "State Abbreviations": "TX", "Rank": 6, "Score": 81.42, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "10.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.50%", "Breakup_Percent": 10.0, "Moved_Percent": 16.5}, {"State": "Arkansas", "State Abbreviations": "AR", "Rank": 7, "Score": 80.97, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.00%", "Breakup_Percent": 8.0, "Moved_Percent": 15.0}, {"State": "Washington", "State Abbreviations": "WA", "Rank": 7, "Score": 80.97, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "17.50%", "Breakup_Percent": 7.0, "Moved_Percent": 17.5}, {"State": "Delaware", "State Abbreviations": "DE", "Rank": 9, "Score": 71.15, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.50%", "Breakup_Percent": 7.5, "Moved_Percent": 16.5}, {"State": "Oregon", "State Abbreviations": "OR", "Rank": 10, "Score": 70.69, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.50%", "Breakup_Percent": 8.0, "Moved_Percent": 12.5}, {"State": "Alabama", "State Abbreviations": "AL", "Rank": 11, "Score": 70.24, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "10.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.00%", "Breakup_Percent": 10.5, "Moved_Percent": 16.0}, {"State": "Rhode Island", "State Abbreviations": "RI", "Rank": 12, "Score": 68.43, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "13.00%", "Breakup_Percent": 8.0, "Moved_Percent": 13.0}, {"State": "California", "State Abbreviations": "CA", "Rank": 13, "Score": 66.31, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "10.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.00%", "Breakup_Percent": 10.0, "Moved_Percent": 15.0}, {"State": "Massachusetts", "State Abbreviations": "MA", "Rank": 14, "Score": 65.41, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "9.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.50%", "Breakup_Percent": 9.0, "Moved_Percent": 15.5}, {"State": "New York", "State Abbreviations": "NY", "Rank": 15, "Score": 62.39, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "8.50%", "Breakup_Percent": 8.0, "Moved_Percent": 8.5}, {"State": "Maryland", "State Abbreviations": "MD", "Rank": 16, "Score": 61.18, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.00%", "Breakup_Percent": 7.0, "Moved_Percent": 16.0}, {"State": "Illinois", "State Abbreviations": "IL", "Rank": 17, "Score": 59.82, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "17.00%", "Breakup_Percent": 7.0, "Moved_Percent": 17.0}, {"State": "Wisconsin", "State Abbreviations": "WI", "Rank": 17, "Score": 59.82, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "10.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "14.50%", "Breakup_Percent": 10.5, "Moved_Percent": 14.5}, {"State": "New Jersey", "State Abbreviations": "NJ", "Rank": 19, "Score": 59.21, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.00%", "Breakup_Percent": 5.5, "Moved_Percent": 16.0}, {"State": "New Mexico", "State Abbreviations": "NM", "Rank": 20, "Score": 54.83, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "17.00%", "Breakup_Percent": 7.5, "Moved_Percent": 17.0}, {"State": "West Virginia", "State Abbreviations": "WV", "Rank": 21, "Score": 53.47, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.00%", "Breakup_Percent": 5.5, "Moved_Percent": 15.0}, {"State": "Minnesota", "State Abbreviations": "MN", "Rank": 22, "Score": 51.21, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.00%", "Breakup_Percent": 8.0, "Moved_Percent": 15.0}, {"State": "New Hampshire", "State Abbreviations": "NH", "Rank": 23, "Score": 48.19, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.50%", "Breakup_Percent": 5.0, "Moved_Percent": 12.5}, {"State": "Utah", "State Abbreviations": "UT", "Rank": 24, "Score": 44.86, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "13.00%", "Breakup_Percent": 5.5, "Moved_Percent": 13.0}, {"State": "Louisiana", "State Abbreviations": "LA", "Rank": 25, "Score": 43.5, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "11.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "11.50%", "Breakup_Percent": 11.0, "Moved_Percent": 11.5}, {"State": "North Dakota", "State Abbreviations": "ND", "Rank": 26, "Score": 43.2, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "6.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.50%", "Breakup_Percent": 6.0, "Moved_Percent": 16.5}, {"State": "Mississippi", "State Abbreviations": "MS", "Rank": 27, "Score": 42.45, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "14.50%", "Breakup_Percent": 7.5, "Moved_Percent": 14.5}, {"State": "Arizona", "State Abbreviations": "AZ", "Rank": 28, "Score": 40.03, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "6.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "14.50%", "Breakup_Percent": 6.0, "Moved_Percent": 14.5}, {"State": "Vermont", "State Abbreviations": "VT", "Rank": 29, "Score": 38.07, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "6.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.50%", "Breakup_Percent": 6.0, "Moved_Percent": 12.5}, {"State": "Connecticut", "State Abbreviations": "CT", "Rank": 30, "Score": 34.74, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "6.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "9.50%", "Breakup_Percent": 6.5, "Moved_Percent": 9.5}, {"State": "North Carolina", "State Abbreviations": "NC", "Rank": 31, "Score": 32.78, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "8.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.50%", "Breakup_Percent": 8.5, "Moved_Percent": 12.5}, {"State": "Ohio", "State Abbreviations": "OH", "Rank": 32, "Score": 32.48, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.00%", "Breakup_Percent": 3.0, "Moved_Percent": 12.0}, {"State": "Idaho", "State Abbreviations": "ID", "Rank": 33, "Score": 32.33, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "14.00%", "Breakup_Percent": 7.5, "Moved_Percent": 14.0}, {"State": "Indiana", "State Abbreviations": "IN", "Rank": 34, "Score": 32.02, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "7.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "11.50%", "Breakup_Percent": 7.0, "Moved_Percent": 11.5}, {"State": "South Dakota", "State Abbreviations": "SD", "Rank": 35, "Score": 31.27, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "16.50%", "Breakup_Percent": 5.0, "Moved_Percent": 16.5}, {"State": "Kentucky", "State Abbreviations": "KY", "Rank": 36, "Score": 29.46, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.00%", "Breakup_Percent": 5.0, "Moved_Percent": 12.0}, {"State": "Tennessee", "State Abbreviations": "TN", "Rank": 37, "Score": 28.85, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.50%", "Breakup_Percent": 5.5, "Moved_Percent": 12.5}, {"State": "Kansas", "State Abbreviations": "KS", "Rank": 38, "Score": 25.68, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "19.00%", "Breakup_Percent": 5.0, "Moved_Percent": 19.0}, {"State": "Wyoming", "State Abbreviations": "WY", "Rank": 39, "Score": 25.53, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "8.00%", "Breakup_Percent": 5.5, "Moved_Percent": 8.0}, {"State": "Florida", "State Abbreviations": "FL", "Rank": 40, "Score": 22.05, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "13.00%", "Breakup_Percent": 5.0, "Moved_Percent": 13.0}, {"State": "South Carolina", "State Abbreviations": "SC", "Rank": 41, "Score": 19.49, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "14.50%", "Breakup_Percent": 5.5, "Moved_Percent": 14.5}, {"State": "Oklahoma", "State Abbreviations": "OK", "Rank": 42, "Score": 16.92, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "17.00%", "Breakup_Percent": 5.0, "Moved_Percent": 17.0}, {"State": "Hawaii", "State Abbreviations": "HI", "Rank": 43, "Score": 13.6, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "12.00%", "Breakup_Percent": 3.5, "Moved_Percent": 12.0}, {"State": "Iowa", "State Abbreviations": "IA", "Rank": 43, "Score": 13.6, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "9.50%", "Breakup_Percent": 3.0, "Moved_Percent": 9.5}, {"State": "Nebraska", "State Abbreviations": "NE", "Rank": 45, "Score": 10.12, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "11.00%", "Breakup_Percent": 5.0, "Moved_Percent": 11.0}, {"State": "Michigan", "State Abbreviations": "MI", "Rank": 46, "Score": 9.06, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "6.50%", "Breakup_Percent": 3.5, "Moved_Percent": 6.5}, {"State": "Missouri", "State Abbreviations": "MO", "Rank": 47, "Score": 8.91, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "5.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "10.50%", "Breakup_Percent": 5.5, "Moved_Percent": 10.5}, {"State": "Maine", "State Abbreviations": "ME", "Rank": 48, "Score": 1.96, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.00%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "11.00%", "Breakup_Percent": 3.0, "Moved_Percent": 11.0}, {"State": "Montana", "State Abbreviations": "MT", "Rank": 49, "Score": 1.06, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "15.00%", "Breakup_Percent": 3.5, "Moved_Percent": 15.0}, {"State": "Pennsylvania", "State Abbreviations": "PA", "Rank": 50, "Score": 0.0, "Percentage of dog owners who broke up with a significant other who didn't like their dog": "3.50%", "Percentage of dog owners who moved from an apartment to a house so their dog would have a yard": "9.00%", "Breakup_Percent": 3.5, "Moved_Percent": 9.0}];

var selectedStates = [];
var originalColors = null;
var originalLineWidths = null;

function getStateByAbbr(abbr) {
    return stateData.find(function(s) { return s['State Abbreviations'] === abbr; });
}

function closeComparison() {
    document.getElementById('comparison-panel').classList.remove('active');
    selectedStates = [];
    resetMapHighlight();
}

function resetMapHighlight() {
    var gd = document.querySelector('.plotly-graph-div');
    if (!gd || !gd.data) return;
    
    // Reset to original colors
    if (originalColors) {
        Plotly.restyle(gd, {
            'marker.line.color': [originalColors],
            'marker.line.width': [originalLineWidths || 1]
        }, [0]);
    }
}

function highlightStates(stateAbbrs) {
    var gd = document.querySelector('.plotly-graph-div');
    if (!gd || !gd.data) return;
    
    // Get current line colors and widths
    var currentData = gd.data[0];
    var locations = currentData.locations;
    
    // Store original if not already stored
    if (!originalColors) {
        originalColors = currentData.marker.line.color || 'white';
        originalLineWidths = currentData.marker.line.width || 1;
    }
    
    // Create new line colors and widths
    var newLineColors = locations.map(function(abbr) {
        return stateAbbrs.indexOf(abbr) >= 0 ? '#3498db' : 'white';
    });
    
    var newLineWidths = locations.map(function(abbr) {
        return stateAbbrs.indexOf(abbr) >= 0 ? 3 : 1;
    });
    
    Plotly.restyle(gd, {
        'marker.line.color': [newLineColors],
        'marker.line.width': [newLineWidths]
    }, [0]);
}

function updateComparisonPanel() {
    var panel = document.getElementById('comparison-panel');
    var instruction = document.getElementById('comparison-instruction');
    var comparison = document.getElementById('state-comparison');
    var diff = document.getElementById('comparison-diff');
    
    if (selectedStates.length === 0) {
        panel.classList.remove('active');
        return;
    }
    
    panel.classList.add('active');
    
    if (selectedStates.length === 1) {
        instruction.style.display = 'block';
        instruction.textContent = 'Click another state to compare';
        comparison.style.display = 'none';
        diff.style.display = 'none';
    } else if (selectedStates.length === 2) {
        instruction.style.display = 'none';
        comparison.style.display = 'grid';
        diff.style.display = 'block';
        
        var state1 = getStateByAbbr(selectedStates[0]);
        var state2 = getStateByAbbr(selectedStates[1]);
        
        // Update state 1
        document.getElementById('state1-name').textContent = state1.State;
        document.getElementById('state1-score').textContent = state1.Score.toFixed(2);
        document.getElementById('state1-rank').textContent = '#' + state1.Rank;
        document.getElementById('state1-moved').textContent = state1.Moved_Percent.toFixed(1) + '%';
        document.getElementById('state1-breakup').textContent = state1.Breakup_Percent.toFixed(1) + '%';
        document.getElementById('state1-box').classList.add('selected');
        
        // Update state 2
        document.getElementById('state2-name').textContent = state2.State;
        document.getElementById('state2-score').textContent = state2.Score.toFixed(2);
        document.getElementById('state2-rank').textContent = '#' + state2.Rank;
        document.getElementById('state2-moved').textContent = state2.Moved_Percent.toFixed(1) + '%';
        document.getElementById('state2-breakup').textContent = state2.Breakup_Percent.toFixed(1) + '%';
        document.getElementById('state2-box').classList.add('selected');
        
        // Calculate differences
        var scoreDiff = state1.Score - state2.Score;
        var movedDiff = state1.Moved_Percent - state2.Moved_Percent;
        var breakupDiff = state1.Breakup_Percent - state2.Breakup_Percent;
        
        document.getElementById('diff-score').textContent = (scoreDiff >= 0 ? '+' : '') + scoreDiff.toFixed(2);
        document.getElementById('diff-score').className = scoreDiff >= 0 ? 'diff-positive' : 'diff-negative';
        
        document.getElementById('diff-moved').textContent = (movedDiff >= 0 ? '+' : '') + movedDiff.toFixed(1) + '%';
        document.getElementById('diff-moved').className = movedDiff >= 0 ? 'diff-positive' : 'diff-negative';
        
        document.getElementById('diff-breakup').textContent = (breakupDiff >= 0 ? '+' : '') + breakupDiff.toFixed(1) + '%';
        document.getElementById('diff-breakup').className = breakupDiff >= 0 ? 'diff-positive' : 'diff-negative';
        
        // Highlight states on map
        highlightStates(selectedStates);
    }
}

// Wait for Plotly to initialize, then add click handler
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        var gd = document.querySelector('.plotly-graph-div');
        if (!gd) return;
        
        gd.on('plotly_click', function(data) {
            if (data.points && data.points.length > 0) {
                var clickedState = data.points[0].location;
                
                // If clicking the same state, deselect it
                var index = selectedStates.indexOf(clickedState);
                if (index >= 0) {
                    selectedStates.splice(index, 1);
                } else {
                    // Add state (max 2)
                    if (selectedStates.length < 2) {
                        selectedStates.push(clickedState);
                    } else {
                        // Replace first state with new one
                        selectedStates[0] = selectedStates[1];
                        selectedStates[1] = clickedState;
                    }
                }
                
                updateComparisonPanel();
            }
        });
    }, 500);
});
</script>
</body>
</html>